# KinematicDomainWallModel
Supplementary code for "Kinematic Model of Magnetic Domain Wall Motion for Fast, High-Accuracy Simulations" by Alexander J. Edwards, Kristi Doleh, Leonard Humphrey, Chandler M. Linseisen, Michael D. Kitcher, Joanna M. Martin, Can Cui, Jean Anne C. Incorvia, Felipe Garcia-Sanchez, Naimul Hassan, and Joseph S. Friedman (2025)

Contact: Alexander.Edwards@utdallas.edu, Leonard.Humphrey@utdallas.edu, fgs@usal.es, Joseph.Friedman@utdallas.edu

# Organization

## `veriloga/veriloga.va`
- Kinematic domain wall mtj model which may be imported into an EDA tool
- Model parameters may be read from `lookup_tables/lookup_all.csv` or obtained using `kdw6_lookup.py`

## `lookup_tables/lookup_all.csv`
- Lookup table of kinematic dw model parameters at each material parameter corner

## `error_tables/all_corners_error.csv`
- Kinematic dw model error at each material parameter corner

## `examples/`

### `veriloga/`
- Contains additional information for running the included kinematic dwmtj veriloga model in Cadence Virtuoso

### `example_lookup.py`
- Demonstates use of `src/kdw/kdw6_lookup.py` to obtain kinematic dw modal parameters

### `example_flow.py`
- Demonstrates use of kdw flow to extend model to alternative parameter corners via additional simulation or experimental data
- Due to size of simulation files, please contact authors for data required to run `example_flow.py`

## `src/kdw/`
- Kdw flow to extend model to additional material parameter corners or new simulation or experimental data
- Kdw lookup table ultility

## `mx3/`

### `DWSim_V=centerWall_Geom=1_Aex=11e-12_Ku=4.05e+5_A=0.01_Msat=7.95e+5_u0Hke=NaN_DMI=NaN_J=4.0e+09_RT=100e-9_W=100e-9.mx3`
- sample mumax3 script for simple constant current pulse input
- The mumax script naming convention should be followed since the kdw flow uses the simulation naming convention to associate the DW data with the micromagnetic parameters.

## `depricated/`

### `README.md`
- See this readme for details about the previous version

# Usage
## Installation
To use any of the python features, create a virtual environment in your workspace.  Then inside the parent folder of .venv or any of its children, source `install.sh` with:

`. install.sh` (Linux) or 
`.\install.ps1` (Windows)

`kdw.kdw[#]_[module]` may then be imported as a python module.

# Kinematic Domain Wall MTJ VerilogA Model
The veriloga model is included in `veriloga/veriloa.va`.  Information for running the model is included in `examples/veriloga/`.

# Model Parameter Lookup
Kinematic dw model parameters are located in `lookup_tables/lookup_all.csv`.  The `src/kdw/kdw6_lookup.py` utility may be used to lookup model parameters for target material parameters.

# Extending model with new simulation or experimental data
The kinematic DW model may be extended to alternative parameter corners, input stimuli, or data; the following sections include scripts to automatically extract model fitting parameters to match new simulation or experimental data.

## Collecting Simulation Data

The Mumax3 DW script in `mx3` may be altered to run simulations with different micromagnetic parameters or input stimuli.  For a fixed parameter corner, multiple simulations should be run with varying stimuli intensity.  The `table.txt` files generated by `mumax3` contain all the data needed to calculate model fitting parameters.  

## Collecting Experimental Data

Experiments should comprise a single uniform stimulus followed by a period without stimulus.  The time-length of both portions of the experiment should be sufficiently long for the DW to accelerate or decelerate to its final velocity, and multiple trials should be performed on the same material sample, varying only the strength of the input stimuli.  Each trial will have its own table, and tables should be stored in folders according to the name convention specified in the following subsection.

Experimental data must match the Mumax3 table.txt format in order for the kdw flow to properly extract model fitting parameters, that is in CSV format, structured according to the following table:

| Time (s) | Unused | Unused | Unused | Norm. Mag. @ 0 nm | Norm. Mag. @ 1 nm | ... | Norm. Mag. @ (N) nm |
| ---      | ---    | ---    | ---    | ---               | ---               | --- | ---                 |
| 0e-9     |        |        |        | 1                 | 1                 | ... | -1                  |
| 1e-9     |        |        |        | 1                 | 1                 | ... | -1                  |
|⋮|⋮|⋮|⋮|⋮|⋮|⋮|⋮|     
|(T)e-9    |        |        |        | 1                 | 0.97              | ... | -1                  |

Time step size may be arbitrary.  At each time step, magnetization of the sample should be measured at equally spaced locations along the length of the nanowire. For perpendicularly (in-plane) magnetized samples, the out-of-plane (track-length-wise) component of the magnetization should be written to the table, normalized to the saturation magnetization of the material. `kdw1_extract.py` will implicitly assume a position step size of 1 nm, matching the Mumax3 template; line 79  of `kdw1_extract.py` (position_step = ...) should be changed to match the experimental spacing between samples.

## Extracting Model Parameters

Run the kdw flow located in `src/kdw/` as exemplified by `examples/example_flow.py`.  All scripts require a single argument, the `home_folder`, which should contain a single folder `simulations` wherein simulation data is stored. Each module in the kdw flow reads and generates additional files within the `home_folder`.

### `kdw1_extract.py`
- function
    - Extracts time resolved DW position and velocity from mumax simulations.
    - Each mumax simulation folder name contains the material parameter values and J with which the sim was run.
- reads
    - `$home_folder/simulations/*[sim_name].out/table.txt` # Mumax output table files
- produces
    - `$home_folder/simulations/*[sim_name].out/data.mat`     # DW position and velocity by time arrays
    - `$home_folder/simulations/*[sim_name].out/position.png` # Position over time trace
    - `$home_folder/simulations/*[sim_name].out/velocity.png` # Velocity over time trace
    - `$home_folder/raw_data/*[sim_name].mat`                 # DW position and velocity by time arrays in a single folder

### `kdw2_analyze.py`
- function
    - Calculates various quantities (drift distance, time constant of velocity, max velocity) for each current density
    - saves quantities to single .mat file per corner, for use in fit_model_constants.m
- reads
    - `$home_folder/raw_data/*[sim_name].mat`                 # DW position and velocity  by time arrays in a single folder
- produces
    - `$home_folder/smoothed_data/*[sim_name].mat` # Smoothed DW position and velocity  by time arrays in a single folder 
    - `$home_folder/smoothed_images/*[sim_name]_smooth.png` # Smoothed position and velocity over time trace
    - `$home_folder/marker_tables/dataTable_*[param_corner].mat` # Each row represents one simulation in the same parameter corner with varying J.  Each row has current density (J), maximum velocity (max_vel), acceleration time constant (time_constant), and drift distance after current is removed (drift_dist)

### `kdw3_fit.py`
- function 
    - Finds model constants by fitting mumax simulation results to model
    - Parses material parameter values from marker_table filenames
    - Creates and saves lookup table for model constants to use in model implementations 
- reads
    - `$home_folder/marker_tables/dataTable_*[param_corner].mat` # Each row represents one simulation in the same parameter corner with varying J.  Each row has current density (J), maximum velocity (max_vel), acceleration time constant (time_constant), and drift distance after current is removed (drift_dist)
- produces
    - `$home_folder/lookup_tables/lookup_all.csv` # Each row is a single parameter corner containing the material parameters followed by the kinemtaic dw model parameters

### `kdw4_evaluate.py`
- function
    - Evaluates the fitted model on the simulation data
    - Tracks four error metrics
        - RMSE J-On: Root mean square percent error of position while current is applied, normalized to final position
        - RMSE J-Off: Root mean square percent error of position after J is removed, normalized to final position
        - Err Pos: Error of final DW position
        - Err Max Vel: Error of maximum DW velocity
    - Plots traces of position and velocity of both kinematic DW model and simulation data
- reads
    - `$home_folder/smoothed_data/*[sim_name].mat` # Smoothed DW position and velocity  by time arrays in a single folder 
    - `$home_folder/lookup_tables/lookup_all.csv` # Each row is a single parameter corner containing the material parameters followed by the kinemtaic dw model parameters
- produces
    - `$home_folder/error_tables/all_sims_error.csv` # Error table for each sim
    - `$home_folder/error_tables/all_corners_error.csv` # Error table averaged over J for each parameter corner
    - `$home_folder/error_tables/error_*[param_corner].csv` # Error table for each corner.  Each sim in that corner gets a row
    - `$home_folder/error_images/*[sim_name]_smooth.png` # Kinematic dw model and mumax simulation position and velocity traces over time

### `kdw5_plot.py`
- function
    - Plot various error metrics aggregated over a variety of parameter corners
- reads
    - `$home_folder/error_tables/all_sims_error.csv` # Error table for each sim
- produces
    - `$home_folder/aggregate_error_plots/*.png` # Plot of all four error metrics over J averaged over some or all parameter corners as specified in plot name.

### `kdw6_lookup.py`
- function
    - Lookup or interpolate kinematic dw model parameters from material parameters and generated lookup table
    - Optionally report model confidence if `all_corners_error.csv` is available
- reads
    - `$home_folder/lookup_tables/lookup_all.csv` # Each row is a single parameter corner containing the material parameters followed by the kinemtaic dw model parameters
    - `$home_folder/error_tables/all_corners_error.csv` # Error table averaged over J for each parameter corner
- returns
    - optimal kinematic dw model parameters
- prints
    - optimal kinematic dw model parameters
    - optional model confidence 

## Filename Conventions

Parameter, stimuli, and timing information of the Mumax3 scripts are communicated in the file and folder names.  It is therefore important to follow the naming convention.  Mumax3 script filenames should be similar to the following:

DWSim_V=centerWall_Geom=1_Aex=11e-12_Ku=4.05e+5_A=0.01_Msat=7.95e+5_u0Hke=NaN_DMI=NaN_J=4.0e+09_RT=100e-9_W=100e-9.mx3

which is broken into a number of tokens, separated by single underscore characters.  Ordering of tokens does not matter.

The tokens "J" and "RT" correspond with "current density" (the stimulation strength) and "run time" (the duration stimulus is applied) and are mainly used by `kdw2_analyze.py` to extract the relationships between DW velocity and current density.

The other tokens represent the micromagnetic material parameters for that trial suite and are only used by `kdw3_fit.py` to write the model parameter lookup tables which are indexed according to the various parameter corners.  Should parameters be added or removed from the filenames, the tracked parameter list in `kdw3_fit.py` should be changed accordingly, please contact the authors for assistance.
